<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L8TRUST</title>
    <style>
        body {
            font-family: "Courier New", Courier, monospace;
            background-color: #000080;
            color: #00FF00;
            font-size: 16px;
            line-height: 1.5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 20px;
        }
        h1 {
            text-align: center;
            font-size: 40px;
            color: #FFFF00;
            text-shadow: 2px 2px #FF00FF;
        }
        #market-status, #major-indices, #rss-feed, #stock-ticker, #sector-performance, #stock-info {
            border: 2px solid #00FF00;
            padding: 10px;
            margin-top: 20px;
            background-color: #000000;
            width: 100%;
            box-sizing: border-box;
        }
        #market-status {
            text-align: center;
        }
        h3 {
            color: #FF00FF;
            text-align: center;
            margin-top: 10px;
            text-decoration: underline;
        }
        .positive-change { color: #00FF00; }
        .negative-change { color: #FF0000; }
        .market-open { color: #00FF00; }
        .market-extended { color: #FFA500; }
        .market-closed { color: #FF0000; }
        .blink {
            animation: blinker 1s linear infinite;
        }
        @keyframes blinker {
            50% { opacity: 0; }
        }
        #refresh-info {
            text-align: center;
            font-size: 14px;
            margin-top: 20px;
            color: #FFFFFF;
        }
        #news-list {
            list-style-type: none;
            padding-left: 20px;
        }
        #news-list li {
            margin-bottom: 10px;
        }
        #news-list a {
            color: #00FF00;
            text-decoration: none;
        }
        #news-list a:hover {
            text-decoration: underline;
        }
        #major-indices {
            text-align: center;
        }
        #stock-ticker {
            overflow: hidden;
            padding: 10px 0;
            white-space: nowrap;
        }
        #ticker-content {
            display: inline-block;
            padding-left: 100%;
            animation: ticker 50s linear infinite;
        }
        #ticker-content:hover {
            animation-play-state: paused;
        }
        #ticker-content span {
            margin-right: 40px;
        }
        @keyframes ticker {
            0% { transform: translate(0, 0); }
            100% { transform: translate(-100%, 0); }
        }
        #sector-chart {
            width: 100%;
            margin-top: 20px;
        }
        .sector-bar {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        .sector-name {
            width: 150px;
            text-align: right;
            padding-right: 10px;
        }
        .bar {
            height: 20px;
            transition: width 0.5s ease-in-out;
        }
        .performance-value {
            margin-left: 5px;
        }
        #utc-clock {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 14px;
            color: #00FF00;
        }
        #stock-search {
            margin-top: 20px;
            text-align: center;
        }
        #stock-search input,
        #stock-search button {
            font-family: "Courier New", Courier, monospace; /* Matching font */
            font-size: 16px;
            background-color: #000000;
            color: #00FF00;
            border: 1px solid #00FF00;
            padding: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="utc-clock"></div>
        <h1 class="blink">L8TRUST</h1>
        <div id="market-status"></div>
        <div id="major-indices">
            <h3>Major Indices</h3>
            <p>
                <span id="spy-performance">S&P 500: -1.12%</span> |
                <span id="qqq-performance">Nasdaq 100: -2.33%</span> |
                <span id="dia-performance">Dow Jones: 0.18%</span>
            </p>
        </div>
        <div id="stock-ticker">
            <div id="ticker-content"></div>
        </div>
        <div id="stock-search">
        <input type="text" id="stock-symbol" placeholder="Enter stock symbol">
        <button onclick="searchStock()">Search</button>
        <button onclick="resetSearch()">Reset</button>
    </div>
        <div id="stock-info"></div>
        <div id="sector-performance">
            <h3>Sector Performance</h3>
            <div id="sector-chart"></div>
        </div>
        
        <div id="rss-feed">
            <h3>Latest News</h3>
            <ul id="news-list"></ul>
        </div>
        <div id="refresh-info">This page will refresh in <span id="countdown">120</span> seconds</div>
    </div>

    <script>
    const apiKey = 'cha3cg1r01qhe0r9rhg0cha3cg1r01qhe0r9rhgg';
    const marketStatusApiKey = 'NQpPDWBnyk3zbab7leFzAavOzTnNpWjY';
    let countdown = 120;

    async function fetchMarketStatus() {
        const marketStatusUrl = `https://api.polygon.io/v1/marketstatus/now?apiKey=${marketStatusApiKey}`;
        try {
            const response = await fetch(marketStatusUrl);
            const data = await response.json();
            if (!data || data.error) {
                throw new Error(data ? data.error : 'Unknown error');
            }
            displayMarketStatus(data);
        } catch (error) {
            console.error('Error fetching market status:', error);
            document.getElementById('market-status').innerHTML = `
                <p>Error fetching market status. ${error.message}</p>
                <p>Check the console for more details.</p>
            `;
        }
    }

    function displayMarketStatus(statusData) {
        const marketStatusElement = document.getElementById('market-status');
        const nyseStatus = statusData.exchanges.nyse;
        const nasdaqStatus = statusData.exchanges.nasdaq;

        const nyseColorClass = (nyseStatus === 'open') 
            ? 'market-open' 
            : (nyseStatus === 'extended-hours') 
            ? 'market-extended' 
            : 'market-closed';

        const nasdaqColorClass = (nasdaqStatus === 'open') 
            ? 'market-open' 
            : (nasdaqStatus === 'extended-hours') 
            ? 'market-extended' 
            : 'market-closed';

        marketStatusElement.innerHTML = `NYSE: 
            <span class="${nyseColorClass}">${nyseStatus}</span>, NASDAQ: 
            <span class="${nasdaqColorClass}">${nasdaqStatus}</span>`;
    }

    async function fetchIndexPerformance(symbol) {
        const url = `https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${apiKey}`;
        const response = await fetch(url);
        const data = await response.json();
        const changePercent = ((data.c - data.pc) / data.pc * 100).toFixed(2);
        return `${changePercent}%`;
    }

    async function displayIndexPerformance(symbol, elementId, indexName) {
        const performanceElement = document.getElementById(elementId);
        try {
            const changePercent = await fetchIndexPerformance(symbol);
            if (performanceElement) {
                const spanElement = document.createElement('span');
                spanElement.textContent = changePercent;
                spanElement.className = parseFloat(changePercent) > 0 ? 'positive-change' : 'negative-change';
                performanceElement.innerHTML = `${indexName}: `;
                performanceElement.appendChild(spanElement);
            }
        } catch (error) {
            console.error(`Error displaying ${indexName} performance:`, error);
            if (performanceElement) {
                performanceElement.textContent = `Error displaying ${indexName} performance.`;
            }
        }
    }

    async function loadRSSFeed() {
        const rssUrl = 'https://breakingthenews.net/news-feed.xml';
        const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(rssUrl)}`;
        
        try {
            const response = await fetch(proxyUrl);
            const xmlText = await response.text();
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
            
            const items = xmlDoc.querySelectorAll('item');
            const newsList = document.getElementById('news-list');
            newsList.innerHTML = '';
            
            items.forEach(item => {
                const title = item.querySelector('title').textContent;
                const link = item.querySelector('link').textContent;
                const li = document.createElement('li');
                const a = document.createElement('a');
                a.href = link;
                a.textContent = title;
                li.appendChild(a);
                newsList.appendChild(li);
            });
        } catch (error) {
            console.error('Error fetching RSS feed:', error);
            document.getElementById('news-list').innerHTML = '<li>Error loading news feed. Please try again later.</li>';
        }
    }

    async function fetchStockData(symbol) {
        const url = `https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${apiKey}`;
        const response = await fetch(url);
        const data = await response.json();
        const changePercent = ((data.c - data.pc) / data.pc * 100).toFixed(2);
        return { symbol, price: data.c.toFixed(2), changePercent };
    }

    async function updateStockTicker() {
        const stocks = ['AAPL', 'MSFT', 'NVDA', 'GOOGL', 'AMZN', 'META', 'BRK-B', 'TSM', 'LLY', 'TSLA', 'AVGO', 'JPM', 'WMT', 'V', 'XOM', 'UNH', 'NVO', 'MA', 'PG', 'ORCL', 'JNJ', 'COST', 'HD', 'ASML', 'BAC', 'MRK', 'ABBV', 'CVX', 'KO', 'NFLX'];
        const tickerContent = document.getElementById('ticker-content');
        tickerContent.innerHTML = '';

        for (const stock of stocks) {
            try {
                const { symbol, price, changePercent } = await fetchStockData(stock);
                const colorClass = parseFloat(changePercent) >= 0 ? 'positive-change' : 'negative-change';
                tickerContent.innerHTML += `<span>${symbol}: $${price} <span class="${colorClass}">${changePercent}%</span></span>`;
            } catch (error) {
                console.error(`Error fetching data for ${stock}:`, error);
            }
        }
    }

    function updateSectorChart(sectorData) {
        const chartContainer = document.getElementById('sector-chart');
        chartContainer.innerHTML = '';

        // Sort sectors by performance
        sectorData.sort((a, b) => b.performance - a.performance);

        // Find the maximum absolute performance for scaling
        const maxPerformance = Math.max(...sectorData.map(s => Math.abs(s.performance)));

        sectorData.forEach(sector => {
            const sectorDiv = document.createElement('div');
            sectorDiv.className = 'sector-bar';

            const nameSpan = document.createElement('span');
            nameSpan.className = 'sector-name';
            nameSpan.textContent = sector.name;

            const barDiv = document.createElement('div');
            barDiv.className = 'bar';
            const width = Math.abs(sector.performance) / maxPerformance * 70; // 70% max width
            barDiv.style.width = `${width}%`;
            barDiv.style.backgroundColor = sector.performance >= 0 ? '#00FF00' : '#FF0000';

            const valueSpan = document.createElement('span');
            valueSpan.className = 'performance-value';
            valueSpan.textContent = `${sector.performance > 0 ? '+' : ''}${sector.performance.toFixed(2)}%`;
            valueSpan.style.color = sector.performance >= 0 ? '#00FF00' : '#FF0000';

            sectorDiv.appendChild(nameSpan);
            sectorDiv.appendChild(barDiv);
            sectorDiv.appendChild(valueSpan);

            chartContainer.appendChild(sectorDiv);
        });
    }

    async function fetchSectorPerformance() {
        const sectors = [
            { symbol: 'XLK', name: 'Technology' },
            { symbol: 'XLV', name: 'Healthcare' },
            { symbol: 'XLF', name: 'Financials' },
            { symbol: 'XLE', name: 'Energy' },
            { symbol: 'XLY', name: 'Consumer Cyclical' },
            { symbol: 'XLP', name: 'Consumer Defensive' },
            { symbol: 'XLI', name: 'Industrials' },
            { symbol: 'XLB', name: 'Basic Materials' },
            { symbol: 'XLU', name: 'Utilities' },
            { symbol: 'XLRE', name: 'Real Estate' },
            { symbol: 'XLC', name: 'Communication Services' }
        ];

        const sectorPerformance = [];

        for (const sector of sectors) {
            try {
                const { symbol, name } = sector;
                const url = `https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${apiKey}`;
                const response = await fetch(url);
                const data = await response.json();
                const performance = ((data.c - data.pc) / data.pc * 100);
                sectorPerformance.push({ name, performance });
            } catch (error) {
                console.error(`Error fetching data for ${sector.name}:`, error);
                sectorPerformance.push({ name: sector.name, performance: 0 });
            }
        }

        updateSectorChart(sectorPerformance);
    }
    
async function searchStock() {
    const symbol = document.getElementById('stock-symbol').value.toUpperCase();
    const stockInfoElement = document.getElementById('stock-info');
    stockInfoElement.innerHTML = 'Loading...';
    try {
        const quoteUrl = `https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${apiKey}`;
        const profileUrl = `https://finnhub.io/api/v1/stock/profile2?symbol=${symbol}&token=${apiKey}`;
        const [quoteResponse, profileResponse] = await Promise.all([
            fetch(quoteUrl),
            fetch(profileUrl)
        ]);
        const quoteData = await quoteResponse.json();
        const profileData = await profileResponse.json();
        if (quoteData.error || profileData.error) {
            throw new Error('Stock not found');
        }
        const marketCap = (profileData.marketCapitalization * 1000000).toLocaleString();
        const peRatio = (quoteData.c / (profileData.finnhubIndustry === 'Technology' ? 20 : 15)).toFixed(2);
        
        // Calculate percentage change
        const percentChange = ((quoteData.c - quoteData.pc) / quoteData.pc * 100).toFixed(2);
        const changeSign = percentChange >= 0 ? '+' : '';
        const changeColor = percentChange >= 0 ? '#00FF00' : '#FF4500'; // Brighter green and orange-red

        stockInfoElement.innerHTML = `
            <h3>${profileData.name} (${symbol})</h3>
            <p><strong>Industry:</strong> ${profileData.finnhubIndustry}</p>
            <p><strong>Price:</strong> $${quoteData.c.toFixed(2)} 
               <span style="background-color: ${changeColor}; color: black; padding: 2px 5px; border-radius: 3px; font-weight: bold;">
                 (${changeSign}${percentChange}%)
               </span>
            </p>
            <p><strong>Market Cap:</strong> $${marketCap}</p>
            <p><strong>Day's High:</strong> $${quoteData.h.toFixed(2)}</p>
            <p><strong>Day's Low:</strong> $${quoteData.l.toFixed(2)}</p>
        `;
    } catch (error) {
        console.error('Error fetching stock data:', error);
        stockInfoElement.innerHTML = 'Error fetching stock data. Please try again.';
    }
}

    function updateUTCClock() {
        const now = new Date();
        const utcString = now.toUTCString();
        document.getElementById('utc-clock').textContent = utcString;
    }

    function refreshAllData() {
        fetchMarketStatus();
        displayIndexPerformance('SPY', 'spy-performance', 'S&P 500');
        displayIndexPerformance('QQQ', 'qqq-performance', 'Nasdaq 100');
        displayIndexPerformance('DIA', 'dia-performance', 'Dow Jones');
        updateStockTicker();
        loadRSSFeed();
        fetchSectorPerformance();
        updateUTCClock();
        countdown = 120;
    }

    function updateCountdown() {
        countdown--;
        document.getElementById('countdown').textContent = countdown;
        if (countdown <= 0) {
            refreshAllData();
        }
    }


    document.addEventListener('DOMContentLoaded', () => {
        refreshAllData();
        setInterval(updateCountdown, 1000);
        setInterval(updateUTCClock, 1000);
    });
    
    function resetSearch() {
        document.getElementById('stock-symbol').value = '';
        document.getElementById('stock-info').innerHTML = '';
    }
    </script>
</body>
</html>
