<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>L8TRUST</title>
<style>
body {
    font-family: "Courier New", Courier, monospace;
    background-color: #000000;
    color: #00FF00;
    font-size: 16px;
    line-height: 1.5;
    margin: 0;
    padding: 0;
}

.white-mode body {
    font-family: "Trebuchet MS", Helvetica, sans-serif;
    background-color: #FFE5CC;
    color: #000000;
    font-size: 16px;
    line-height: 1.5;
    margin: 0;
    padding: 0;
}

.container {
    width: 800px;
    margin: 0 auto;
    padding: 20px;
    border: 2px solid #00FF00;
}

.white-mode .container {
    width: 800px;
    font-family: "Trebuchet MS", Helvetica, sans-serif;
    margin: 0 auto;
    padding: 20px;
    border: 2px solid #000000;
}

h1 {
    text-align: center;
    font-size: 36px;
    color: #FFFF00;
    text-shadow: 2px 2px #000000;
    margin-bottom: 20px;
}

.white-mode h1 {
    text-align: center;
    font-family: "Trebuchet MS", Helvetica, sans-serif;
    font-size: 36px;
    color: #FF00FF;
    text-shadow: 2px 2px #FFFF00;
    margin-bottom: 20px;
}

h3 {
    color: #FF00FF;
    text-align: center;
    margin-top: 20px;
    text-decoration: underline;
}

.white-mode h3 {
    color: #000000;
    font-family: "Trebuchet MS", Helvetica, sans-serif;
    text-align: center;
    margin-top: 20px;
    text-decoration: underline;
}

#market-status, #major-indices, #rss-feed, #stock-ticker, #sector-performance, #stock-info, #stock-search {
    border: 1px dashed #00FF00;
    padding: 10px;
    margin-top: 20px;
    background-color: #000000;
}

.white-mode #market-status, 
.white-mode #major-indices, 
.white-mode #rss-feed, 
.white-mode #stock-ticker, 
.white-mode #sector-performance, 
.white-mode #stock-info, 
.white-mode #stock-search {
    font-family: "Trebuchet MS", Helvetica, sans-serif;
    border: 1px dashed #000000;
    padding: 10px;
    margin-top: 20px;
    background-color: #FFE5CC;
}


#market-status {
    text-align: center;
    text-transform: uppercase;
}

.market-open { color: #00FF00; }
.market-extended { color: #FFA500; }
.market-closed { color: #FF0000; }

.blink {
    animation: blinker 1s step-end infinite;
}

@keyframes blinker {
    50% { opacity: 0; }
}

#refresh-info {
    text-align: center;
    font-size: 14px;
    margin-top: 20px;
    color: #FFFFFF;
}

.white-mode #refresh-info {
    text-align: center;
    font-family: "Trebuchet MS", Helvetica, sans-serif;
    font-size: 14px;
    margin-top: 20px;
    color: #000000;
}

#rss-feed {
    max-height: 300px;
    overflow-y: auto;
}

#news-list {
    list-style-type: square;
    padding-left: 20px;
}

#news-list li {
    margin-bottom: 10px;
}

#news-list a {
    color: #00FF00;
    text-decoration: none;
}

.white-mode #news-list a {
    color: #000000;
    font-family: "Trebuchet MS", Helvetica, sans-serif;
    text-decoration: none;
}

#news-list a:hover {
    text-decoration: underline;
}

.news-timestamp {
    font-size: 0.8em;
    color: #888;
}

#major-indices {
    text-align: center;
}

#stock-ticker {
    overflow: hidden;
    white-space: nowrap;
    background-color: #000000;
    padding: 10px 0;
    border-top: 1px solid #00FF00;
    border-bottom: 1px solid #00FF00;
}

.white-mode #stock-ticker {
    overflow: hidden;
    font-family: "Trebuchet MS", Helvetica, sans-serif;
    white-space: nowrap;
    background-color: #FFE5CC;
    padding: 10px 0;
    border-top: 1px solid #000000;
    border-bottom: 1px solid #000000;
}

#ticker-content {
    display: inline-block;
    padding-left: 100%;
    animation: ticker 30s linear infinite;
    font-size: 16px;
}

#ticker-content span {
    padding: 0 15px;
    border-right: 1px solid #333;
}

#ticker-content span:last-child {
    border-right: none;
}

#ticker-content span:nth-child(even) {
    background-color: #000000;
}

.white-mode #ticker-content span:nth-child(even) {
    background-color: #FFE5CC;
    font-family: "Trebuchet MS", Helvetica, sans-serif;
}

.stock-change {
    display: inline-block;
    min-width: 30px;
    text-align: center;
    padding: 2px 5px;
    margin-left: 5px;
    border-radius: 3px;
    font-weight: bold;
}

@keyframes ticker {
    0% { transform: translate(0, 0); }
    100% { transform: translate(-100%, 0); }
}

#stock-search, {
    margin-top: 20px;
    text-align: center;
}

#stock-search input, 
#stock-search button, 
#load-sectors, 
#metar-search button, 
#metar-search input, 
#metar-tfa-display, 
#weather-section {
    font-family: "Courier New", Courier, monospace;
    font-size: 16px;
    background-color: #000000;
    color: #00FF00;
    border: 1px solid #00FF00;
    padding: 5px;
}

.white-mode #stock-search input, 
.white-mode #stock-search button, 
.white-mode #load-sectors, 
.white-mode #metar-search button, 
.white-mode #metar-search input, 
.white-mode #metar-tfa-display, 
.white-mode #weather-section {
    font-family: "Trebuchet MS", Helvetica, sans-serif;
    font-size: 16px;
    background-color: #FFE5CC;
    color: #000000;
    border: 1px solid #000000;
    padding: 5px;
}


#stock-search button:hover, 
#load-sectors:hover, 
#financial-calculator button:hover,
#metar-search button:hover {
    background-color: #003300;
    cursor: pointer;
}

.white-mode #stock-search button:hover, 
.white-mode #load-sectors:hover, 
.white-mode #financial-calculator button:hover,
.white-mode #metar-search button:hover {
    background-color: #000000;
    font-family: "Trebuchet MS", Helvetica, sans-serif;
    color: #FFE5CC;
    cursor: pointer;
}


#sector-performance {
    margin-top: 20px;
}

.sector-bar {
    display: flex;
    align-items: center;
    margin-bottom: 5px;
}

.sector-name {
    width: 150px;
    text-align: right;
    padding-right: 10px;
}

.bar {
    height: 10px;
    transition: width 0.5s ease-in-out;
}

.performance-value {
    margin-left: 5px;
}

#utc-clock {
    position: relative;
    margin-top: 20px;
    text-align: center;
}

#airport-weather, 
#metar-search {
    margin-top: 10px;
    border: 1px dashed #00FF00;
    padding: 15px;
    background-color: #000000;
}

.white-mode #airport-weather, 
.white-mode #metar-search {
    margin-top: 10px;
    font-family: "Trebuchet MS", Helvetica, sans-serif;
    border: 1px dashed #000000;
    padding: 15px;
    background-color: #FFE5CC;
}


#lfml-metar-taf, 
#lfml-notam, 
#metar-taf-display, 
#notam-display {
    margin-top: 10px;
    white-space: pre-wrap;
    font-size: 16px;
    max-height: 300px;
    overflow-y: auto;
    padding: 10px;
    border: 1px solid #00FF00;
    background-color: #000000; /* Adding background color to match the others */
}

.white-mode #lfml-metar-taf, 
.white-mode #lfml-notam, 
.white-mode #metar-taf-display, 
.white-mode #notam-display {
    margin-top: 10px;
    white-space: pre-wrap;
    font-family: "Trebuchet MS", Helvetica, sans-serif;
    font-size: 16px;
    max-height: 300px;
    overflow-y: auto;
    padding: 10px;
    border: 1px solid #000000;
    background-color: #FFE5CC; /* Adding background color for white mode */
}


.weather-section {
    margin-bottom: 15px;
}

.weather-section h5 {
    color: #00FF00;
    margin-bottom: 5px;
}

.white-mode .weather-section h5 {
    color: #000000;
    font-family: "Trebuchet MS", Helvetica, sans-serif;
    margin-bottom: 5px;
}

.notam-item {
    margin-bottom: 10px;
    padding-bottom: 5px;
    border-bottom: 1px dotted #00FF00;
}

.white-mode .notam-item {
    margin-bottom: 10px;
    font-family: "Trebuchet MS", Helvetica, sans-serif;
    padding-bottom: 5px;
    border-bottom: 1px dotted #000000;
}

.notam-item:last-child {
    border-bottom: none;
}

#financial-calculator {
    margin-top: 20px;
    border: 1px dashed #00FF00;
    padding: 15px;
    background-color: #000000;
}

.white-mode #financial-calculator {
    margin-top: 20px;
    font-family: "Trebuchet MS", Helvetica, sans-serif;
    border: 1px dashed #000000;
    padding: 15px;
    background-color: #FFE5CC;
}

#world-clock {
    margin-top: 20px;
    padding: 15px;
    background-color: #000000;
}

.white-mode #world-clock {
    margin-top: 20px;
    font-family: "Trebuchet MS", Helvetica, sans-serif;
    padding: 15px;
    background-color: #FFE5CC;
}

#financial-calculator input, 
#financial-calculator button {
    display: block;
    font-family: "Courier New", Courier, monospace;
    margin: 10px 0;
    font-size: 16px;
    background-color: #000000;
    color: #00FF00;
    border: 1px solid #00FF00;
    padding: 5px;
}

.white-mode #financial-calculator input, 
.white-mode #financial-calculator button {
    display: block;
    margin: 10px 0;
    font-family: "Trebuchet MS", Helvetica, sans-serif;
    font-size: 16px;
    background-color: #FFE5CC;
    color: #000000;
    border: 1px solid #000000;
    padding: 5px;
}


#mortgage-result {
    margin-top: 10px;
    font-weight: bold;
}

#clock-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    border: 1px dashed #00FF00;
    padding: 10px;
}

.white-mode #clock-container {
    display: flex;
    font-family: "Trebuchet MS", Helvetica, sans-serif;
    flex-wrap: wrap;
    justify-content: space-between;
    border: 1px dashed #000000;
    padding: 10px;
}

.city-clock {
    flex: 1 1 200px;
    margin: 5px;
    padding: 5px;
    border: 1px solid #00FF00;
    text-align: center;
}

.white-mode .city-clock {
    flex: 1 1 200px;
    font-family: "Trebuchet MS", Helvetica, sans-serif;
    margin: 5px;
    padding: 5px;
    border: 1px solid #000000;
    text-align: center;
}

/* From Uiverse.io by andrew-demchenk0 */ 
.switch {
  --input-focus: #2d8cf0; /* Blue for active state */
  --font-color: #323232;
  --font-color-sub: #666;
  --bg-color: #fff;
  --bg-color-alt: #666;
  --main-color: #323232;
  position: absolute; /* Position relative to parent */
  top: 16px;
  left: 315px;
  display: flex;
  align-items: center;
}

.toggle {
  opacity: 0;
  width: 0;
  height: 0;
}

.slider {
  box-sizing: border-box;
  border-radius: 5px;
  border: 2px solid var(--main-color);
  box-shadow: 4px 4px var(--main-color);
  position: relative;
  cursor: pointer;
  width: 50px;
  height: 20px;
  background-color: var(--bg-color);
  transition: 0.3s;
}

.slider:before {
  box-sizing: border-box;
  position: absolute;
  content: "";
  height: 16px;
  width: 16px;
  border: 2px solid var(--main-color);
  border-radius: 5px;
  left: 2px;
  bottom: 2px;
  background-color: var(--bg-color);
  box-shadow: 0 3px 0 var(--main-color);
  transition: 0.3s;
}

.toggle:checked + .slider {
  background-color: var(--input-focus); /* Blue background when checked */
}

.toggle:checked + .slider:before {
  transform: translateX(30px); /* Move knob to the right */
}


</style>
</head>
<body>
    <div class="container">
    <div id="utc-clock"></div>
    
    <div id="world-clock">
       
<label class="switch">
  <input class="toggle" type="checkbox" id="toggle-mode">
  <span class="slider"></span>
</label>

    <div id="clock-container"></div>
    
</div>
    <h1 class="blink">L8TRUST</h1>
    <div id="market-status"></div>
    <div id="major-indices">
        <h3>Major Indices</h3>
        <p>
            <span id="spy-performance">S&P 500: -1.12%</span> |
            <span id="qqq-performance">Nasdaq 100: -2.33%</span> |
            <span id="dia-performance">Dow Jones: 0.18%</span>
        </p>
    </div>
    <div id="stock-ticker">
        <div id="ticker-content"></div>
    </div>
    <div id="stock-search">
        <input type="text" id="stock-symbol" placeholder="Enter stock symbol">
        <button onclick="searchStock()">Search</button>
        <button onclick="resetSearch()">Reset</button>
    </div>
    <div id="stock-info"></div>
    <div id="sector-performance">
        <button id="load-sectors">Load Sector Performance</button>
        <div id="sector-chart" style="display: none;">
            <h3 id="sector-title">Sector Performance</h3>
            <!-- Sector data will be loaded here -->
        </div>
    </div>
    <div id="rss-feed">
        <h3>Latest News</h3>
        <ul id="news-list"></ul>
    </div>
    <div id="airport-weather">
        <h4>LFML Weather</h4>
        <div id="lfml-metar-taf"></div>
        <div id="lfml-notam"></div>
    </div>
    <div id="metar-search">
        <h4>METAR Search</h4>
        <div class="airport-weather-controls">
            <input type="text" id="airport-code" placeholder="Enter airport code">
            <button onclick="fetchAirportWeather()">Get Weather</button>
            <button onclick="refreshAirportWeather()">Refresh</button>
        </div>
        <div id="metar-taf-display"></div>
        <div id="notam-display"></div>
    </div>
    <div id="financial-calculator">
    <h3>Mortgage Calculator</h3>
    <input type="number" id="loan-amount" placeholder="Loan Amount ($)">
    <input type="number" id="interest-rate" placeholder="Annual Interest Rate (%)">
    <input type="number" id="loan-term" placeholder="Loan Term (years)">
    <button onclick="calculateMortgage()">Calculate</button>
    <div id="mortgage-result"></div>
</div>
    <div id="refresh-info">This page will refresh in <span id="countdown">120</span> seconds</div>
</div>
<script>
    const apiKey = 'cha3cg1r01qhe0r9rhg0cha3cg1r01qhe0r9rhgg';
    const marketStatusApiKey = 'NQpPDWBnyk3zbab7leFzAavOzTnNpWjY';
    let countdown = 120;

    async function fetchMarketStatus() {
        const marketStatusUrl = `https://api.polygon.io/v1/marketstatus/now?apiKey=${marketStatusApiKey}`;
        try {
            const response = await fetch(marketStatusUrl);
            const data = await response.json();
            if (!data || data.error) {
                throw new Error(data ? data.error : 'Unknown error');
            }
            displayMarketStatus(data);
        } catch (error) {
            console.error('Error fetching market status:', error);
            document.getElementById('market-status').innerHTML = `
                <p>Error fetching market status. ${error.message}</p>
                <p>Check the console for more details.</p>
            `;
        }
    }

    function displayMarketStatus(statusData) {
        const marketStatusElement = document.getElementById('market-status');
        const nyseStatus = statusData.exchanges.nyse;
        const nasdaqStatus = statusData.exchanges.nasdaq;

        function getStatusColor(status) {
            switch (status) {
                case 'open':
                    return '#00FF00';  // Green
                case 'closed':
                    return '#FF4500';  // Red
                case 'extended-hours':
                    return '#FFA500';  // Orange
                default:
                    return '#FFFFFF';  // White (default)
            }
        }

        function createStatusSpan(status) {
            const spanElement = document.createElement('span');
            spanElement.textContent = status;
            spanElement.style.backgroundColor = getStatusColor(status);
            spanElement.style.color = 'black';
            spanElement.style.padding = '2px 5px';
            spanElement.style.borderRadius = '3px';
            spanElement.style.fontWeight = 'bold';
            return spanElement;
        }

        marketStatusElement.innerHTML = '';
        marketStatusElement.appendChild(document.createTextNode('NYSE: '));
        marketStatusElement.appendChild(createStatusSpan(nyseStatus));
        marketStatusElement.appendChild(document.createTextNode(' NASDAQ: '));
        marketStatusElement.appendChild(createStatusSpan(nasdaqStatus));
    }

    async function fetchIndexPerformance(symbol) {
        const url = `https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${apiKey}`;
        const response = await fetch(url);
        const data = await response.json();
        const changePercent = ((data.c - data.pc) / data.pc * 100).toFixed(2);
        return `${changePercent}%`;
    }

    async function displayIndexPerformance(symbol, elementId, indexName) {
        const performanceElement = document.getElementById(elementId);
        try {
            const changePercent = await fetchIndexPerformance(symbol);
            if (performanceElement) {
                const spanElement = document.createElement('span');
                const numericChange = parseFloat(changePercent);
                spanElement.textContent = `${numericChange >= 0 ? '+' : ''}${changePercent}`;
                const changeColor = numericChange >= 0 ? '#00FF00' : '#FF4500';
                spanElement.style.backgroundColor = changeColor;
                spanElement.style.color = 'black';
                spanElement.style.padding = '2px 5px';
                spanElement.style.borderRadius = '3px';
                spanElement.style.fontWeight = 'bold';
                performanceElement.innerHTML = `${indexName}: `;
                performanceElement.appendChild(spanElement);
            }
        } catch (error) {
            console.error(`Error displaying ${indexName} performance:`, error);
            if (performanceElement) {
                performanceElement.textContent = `Error displaying ${indexName} performance.`;
            }
        }
    }

    async function loadRSSFeed() {
        const rssUrl = 'https://breakingthenews.net/news-feed.xml';
        const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(rssUrl)}`;
        
        try {
            const response = await fetch(proxyUrl);
            const xmlText = await response.text();
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
            
            const items = xmlDoc.querySelectorAll('item');
            const newsList = document.getElementById('news-list');
            newsList.innerHTML = '';
            
            items.forEach(item => {
                const title = item.querySelector('title').textContent;
                const link = item.querySelector('link').textContent;
                const pubDate = new Date(item.querySelector('pubDate').textContent);
                const description = item.querySelector('description').textContent;
                
                const li = document.createElement('li');
                const a = document.createElement('a');
                a.href = link;
                a.textContent = title;
                
                const descriptionSpan = document.createElement('span');
                descriptionSpan.innerHTML = truncateDescription(description, 100);
                
                const timestampSpan = document.createElement('span');
                timestampSpan.className = 'news-timestamp';
                timestampSpan.textContent = formatDate(pubDate);
                
                li.appendChild(a);
                li.appendChild(descriptionSpan);
                li.appendChild(timestampSpan);
                newsList.appendChild(li);
            });
        } catch (error) {
            console.error('Error fetching RSS feed:', error);
            document.getElementById('news-list').innerHTML = '<li>Error loading news feed. Please try again later.</li>';
        }
    }

    function truncateDescription(description, maxLength) {
        const strippedDescription = description.replace(/<[^>]*>/g, '');
        if (strippedDescription.length > maxLength) {
            return strippedDescription.substring(0, maxLength);
        }
        return strippedDescription;
    }

    function formatDate(date) {
        const now = new Date();
        const diffMs = now - date;
        const diffMins = Math.round(diffMs / 60000);
        const diffHours = Math.round(diffMins / 60);

        if (diffMins < 60) {
            return `${diffMins} minute${diffMins !== 1 ? 's' : ''} ago`;
        } else if (diffHours < 24) {
            return `${diffHours} hour${diffHours !== 1 ? 's' : ''} ago`;
        } else {
            return date.toLocaleString('en-US', { 
                month: 'short', 
                day: 'numeric', 
                hour: 'numeric', 
                minute: 'numeric'
            });
        }
    }

    async function fetchStockData(symbol) {
        const url = `https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${apiKey}`;
        const response = await fetch(url);
        const data = await response.json();
        const changePercent = ((data.c - data.pc) / data.pc * 100).toFixed(2);
        return { symbol, price: data.c.toFixed(2), changePercent };
    }

    async function updateStockTicker() {
        const stocks = ['AAPL', 'MSFT', 'NVDA', 'GOOGL', 'AMZN', 'META', 'BRK-B', 'TSM', 'LLY', 'TSLA'];
        const tickerContent = document.getElementById('ticker-content');
        tickerContent.innerHTML = '';

        for (const stock of stocks) {
            try {
                const { symbol, price, changePercent } = await fetchStockData(stock);
                const numericChange = parseFloat(changePercent);
                const changeColor = numericChange >= 0 ? '#00FF00' : '#FF4500';
                const changeSign = numericChange >= 0 ? '+' : '';
                
                tickerContent.innerHTML += `
    <span>${symbol}: $${price} 
        <span class="stock-change" style="background-color: ${changeColor}; color: black;">
            ${changeSign}${changePercent}%
        </span>
    </span>
`;
            } catch (error) {
                console.error(`Error fetching data for ${stock}:`, error);
            }
        }
    }

    async function fetchSectorPerformance() {
        const sectors = [
            { symbol: 'XLK', name: 'Technology' },
            { symbol: 'XLV', name: 'Healthcare' },
            { symbol: 'XLF', name: 'Financials' },
            { symbol: 'XLE', name: 'Energy' },
            { symbol: 'XLU', name: 'Utilities' },
            { symbol: 'XLI', name: 'Industrial' },
            { symbol: 'XLP', name: 'Consumer Staples' },
            { symbol: 'XLB', name: 'Materials' },
            { symbol: 'XLY', name: 'Consumer Cyclical' }
        ];

        const sectorPerformance = [];

        for (const sector of sectors) {
            try {
                const { symbol, name } = sector;
                const url = `https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${apiKey}`;
                const response = await fetch(url);
                const data = await response.json();
                const performance = ((data.c - data.pc) / data.pc * 100);
                sectorPerformance.push({ name, performance });
            } catch (error) {
                console.error(`Error fetching data for ${sector.name}:`, error);
                sectorPerformance.push({ name: sector.name, performance: 0 });
            }
        }

        updateSectorChart(sectorPerformance);
    }

    function updateSectorChart(sectorData) {
        const chartContainer = document.getElementById('sector-chart');
        chartContainer.innerHTML = '<h3 id="sector-title">Sector Performance</h3>';

        sectorData.sort((a, b) => b.performance - a.performance);
        const maxPerformance = Math.max(...sectorData.map(s => Math.abs(s.performance)));

        sectorData.forEach(sector => {
            const sectorDiv = document.createElement('div');
            sectorDiv.className = 'sector-bar';

            const nameSpan = document.createElement('span');
            nameSpan.className = 'sector-name';
            nameSpan.textContent = sector.name;

            const barDiv = document.createElement('div');
            barDiv.className = 'bar';
            const width = Math.abs(sector.performance) / maxPerformance * 70;
            barDiv.style.width = `${width}%`;
            barDiv.style.backgroundColor = sector.performance >= 0 ? '#00FF00' : '#FF0000';

            const valueSpan = document.createElement('span');
            valueSpan.className = 'performance-value';
            valueSpan.textContent = `${sector.performance > 0 ? '+' : ''}${sector.performance.toFixed(2)}%`;
            valueSpan.style.color = sector.performance >= 0 ? '#00FF00' : '#FF0000';

            sectorDiv.appendChild(nameSpan);
            sectorDiv.appendChild(barDiv);
            sectorDiv.appendChild(valueSpan);

            chartContainer.appendChild(sectorDiv);
        });
    }

    async function searchStock() {
        const symbol = document.getElementById('stock-symbol').value.toUpperCase();
        const stockInfoElement = document.getElementById('stock-info');
        stockInfoElement.innerHTML = 'Loading...';
        try {
            const quoteUrl = `https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${apiKey}`;
            const profileUrl = `https://finnhub.io/api/v1/stock/profile2?symbol=${symbol}&token=${apiKey}`;
            const [quoteResponse, profileResponse] = await Promise.all([
                fetch(quoteUrl),
                fetch(profileUrl)
            ]);
            const quoteData = await quoteResponse.json();
            const profileData = await profileResponse.json();
            if (quoteData.error || profileData.error) {
                throw new Error('Stock not found');
            }
            const marketCap = (profileData.marketCapitalization * 1000000).toLocaleString();
            const peRatio = (quoteData.c / (profileData.finnhubIndustry === 'Technology' ? 20 : 15)).toFixed(2);
            
            const percentChange = ((quoteData.c - quoteData.pc) / quoteData.pc * 100).toFixed(2);
            const changeSign = percentChange >= 0 ? '+' : '';
            const changeColor = percentChange >= 0 ? '#00FF00' : '#FF4500';

            stockInfoElement.innerHTML = `
                <h3>${profileData.name} (${symbol})</h3>
                <p><strong>Industry:</strong> ${profileData.finnhubIndustry}</p>
                <p><strong>Price:</strong> $${quoteData.c.toFixed(2)} 
                   <span style="background-color: ${changeColor}; color: black; padding: 2px 5px; border-radius: 3px; font-weight: bold;">
                     (${changeSign}${percentChange}%)
                   </span>
                </p>
                <p><strong>Market Cap:</strong> $${marketCap}</p>
                <p><strong>Day's High:</strong> $${quoteData.h.toFixed(2)}</p>
                <p><strong>Day's Low:</strong> $${quoteData.l.toFixed(2)}</p>
            `;
        } catch (error) {
            console.error('Error fetching stock data:', error);
            stockInfoElement.innerHTML = 'Error fetching stock data. Please try again.';
        }
    }

    function resetSearch() {
        document.getElementById('stock-symbol').value = '';
        document.getElementById('stock-info').innerHTML = '';
    }

    function updateUTCClock() {
        const now = new Date();
        const utcString = now.toUTCString();
        document.getElementById('utc-clock').textContent = utcString;
    }

    function refreshAllData() {
        fetchMarketStatus();
        displayIndexPerformance('SPY', 'spy-performance', 'S&P 500');
        displayIndexPerformance('QQQ', 'qqq-performance', 'Nasdaq 100');
        displayIndexPerformance('DIA', 'dia-performance', 'Dow Jones');
        updateStockTicker();
        loadRSSFeed();
        fetchLFMLWeather();
        updateUTCClock();
        countdown = 120;
    }

    function updateCountdown() {
        countdown--;
        document.getElementById('countdown').textContent = countdown;
        if (countdown <= 0) {
            refreshAllData();
        }
    }

    function getCurrentTimestamp() {
        return new Date().getTime();
    }

    async function fetchAirportWeather() {
        const airportCode = document.getElementById('airport-code').value.toUpperCase();
        await getAirportWeather(airportCode);
    }

    async function refreshAirportWeather() {
        const airportCode = document.getElementById('airport-code').value.toUpperCase();
        if (airportCode) {
            await getAirportWeather(airportCode);
        } else {
            alert('Please enter an airport code before refreshing.');
        }
    }

    async function getAirportWeather(airportCode) {
        const metarTafDisplay = document.getElementById('metar-taf-display');
        const notamDisplay = document.getElementById('notam-display');
        metarTafDisplay.textContent = 'Loading...';
        notamDisplay.textContent = 'Loading...';

        const corsProxy = 'https://corsproxy.io/?';
        const timestamp = getCurrentTimestamp();
        const metarUrl = `${corsProxy}${encodeURIComponent(`https://aviationweather.gov/api/data/metar?ids=${airportCode}&format=raw&hours=0&_=${timestamp}`)}`;
        const tafUrl = `${corsProxy}${encodeURIComponent(`https://aviationweather.gov/api/data/taf?ids=${airportCode}&format=raw&_=${timestamp}`)}`;

        try {
            const [metarResponse, tafResponse, notamData] = await Promise.all([
                fetch(metarUrl),
                fetch(tafUrl),
                fetchNOTAM(airportCode)
            ]);

            if (!metarResponse.ok || !tafResponse.ok) {
                throw new Error('Failed to fetch weather data');
            }

            const metarText = await metarResponse.text();
            const tafText = await tafResponse.text();

            let metarTafContent = '';
            let notamContent = '';
            
            metarTafContent += `<div class="weather-section">
                <h5>METAR:</h5>
                ${metarText.trim() || 'Not available'}
            </div>`;

            metarTafContent += `<div class="weather-section">
                <h5>TAF:</h5>
                ${tafText.trim() || 'Not available'}
            </div>`;

            if (notamData && notamData.length > 0) {
                notamContent += `<h5>NOTAM:</h5>`;
                notamData.forEach((notam, index) => {
                    notamContent += `<div class="notam-item">
                        ${index + 1}. ${notam.ItemQ}: ${notam.ItemE}
                    </div>`;
                });
            } else {
                notamContent += 'NOTAM: Not available';
            }

            metarTafDisplay.innerHTML = metarTafContent;
            notamDisplay.innerHTML = notamContent;
        } catch (error) {
            console.error('Error fetching airport data:', error);
            metarTafDisplay.textContent = `Error: ${error.message}. Please check the airport code and try again.`;
            notamDisplay.textContent = '';
        }
    }

    async function fetchLFMLWeather() {
        const displayElement = document.getElementById('lfml-metar-taf');
        displayElement.textContent = 'Loading LFML weather...';

        const corsProxy = 'https://corsproxy.io/?';
        const timestamp = getCurrentTimestamp();
        const metarUrl = `${corsProxy}${encodeURIComponent(`https://aviationweather.gov/api/data/metar?ids=LFML&format=raw&hours=0&_=${timestamp}`)}`;
        const tafUrl = `${corsProxy}${encodeURIComponent(`https://aviationweather.gov/api/data/taf?ids=LFML&format=raw&_=${timestamp}`)}`;

        try {
            const [metarResponse, tafResponse, notamData] = await Promise.all([
                fetch(metarUrl),
                fetch(tafUrl),
                fetchNOTAM('LFML')
            ]);

            if (!metarResponse.ok || !tafResponse.ok) {
                throw new Error('Failed to fetch LFML weather data');
            }

            const metarText = await metarResponse.text();
            const tafText = await tafResponse.text();

            let content = '';
            
            if (metarText.trim()) {
                content += `<strong>METAR:</strong>\n${metarText.trim()}\n\n`;
            } else {
                content += `<strong>METAR:</strong> Not available\n\n`;
            }

            if (tafText.trim()) {
                content += `<strong>TAF:</strong>\n${tafText.trim()}\n\n`;
            } else {
                content += `<strong>TAF:</strong> Not available\n\n`;
            }

            if (notamData && notamData.length > 0) {
                content += `<strong>NOTAM:</strong>\n`;
                notamData.forEach((notam, index) => {
                    content += `${index + 1}. ${notam.ItemQ}: ${notam.ItemE}\n`;
                });
            } else {
                content += `<strong>NOTAM:</strong> Not available`;
            }

            displayElement.innerHTML = content;
        } catch (error) {
            console.error('Error fetching LFML data:', error);
            displayElement.textContent = `Error: ${error.message}. Please try again later.`;
        }
    }

    async function fetchNOTAM(airportCode) {
    const apiUrl = `https://api.autorouter.aero/v1.0/notam?itemas=["${airportCode}"]&offset=0&limit=10`;
    const corsProxyUrl = `https://corsproxy.io/?${encodeURIComponent(apiUrl)}`;
    try {
        const response = await fetch(corsProxyUrl);
        if (!response.ok) {
            throw new Error('Failed to fetch NOTAM data');
        }
        const data = await response.json();
        return data;
    } catch (error) {
        console.error('Error fetching NOTAM:', error);
        return null;
    }
}
function calculateMortgage() {
    const amount = parseFloat(document.getElementById('loan-amount').value);
    const rate = parseFloat(document.getElementById('interest-rate').value) / 100 / 12;
    const term = parseFloat(document.getElementById('loan-term').value) * 12;

    if (isNaN(amount) || isNaN(rate) || isNaN(term)) {
        document.getElementById('mortgage-result').textContent = 'Please enter valid numbers.';
        return;
    }

    const monthlyPayment = (amount * rate * Math.pow(1 + rate, term)) / (Math.pow(1 + rate, term) - 1);
    const totalPayment = monthlyPayment * term;

    document.getElementById('mortgage-result').innerHTML = `
        Monthly Payment: $${monthlyPayment.toFixed(2)}<br>
        Total Payment: $${totalPayment.toFixed(2)}
    `;
}
function updateWorldClock() {
    const cities = [
        { name: 'New York', timezone: 'America/New_York' },
        { name: 'Paris', timezone: 'Europe/Paris' },
        { name: 'London', timezone: 'Europe/London' },
        { name: 'Tokyo', timezone: 'Asia/Tokyo' },
        { name: 'Sydney', timezone: 'Australia/Sydney' }
    ];

    const clockContainer = document.getElementById('clock-container');
    clockContainer.innerHTML = '';

    cities.forEach(city => {
        const now = new Date();
        const cityTime = now.toLocaleString('en-US', { timeZone: city.timezone, hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false });
        const cityDate = now.toLocaleDateString('en-US', { timeZone: city.timezone, weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' });
        
        const cityDiv = document.createElement('div');
        cityDiv.className = 'city-clock';
        cityDiv.innerHTML = `<strong>${city.name}:</strong> ${cityTime} <small>(${cityDate})</small>`;
        clockContainer.appendChild(cityDiv);
    });
}

    document.addEventListener('DOMContentLoaded', () => {
        refreshAllData();
        setInterval(updateCountdown, 1000);
        setInterval(updateWorldClock, 1000);
        setInterval(updateUTCClock, 1000);
        
        const loadSectorsButton = document.getElementById('load-sectors');
        loadSectorsButton.addEventListener('click', async () => {
            const sectorChart = document.getElementById('sector-chart');
            if (sectorChart.style.display === 'none') {
                loadSectorsButton.disabled = true;
                loadSectorsButton.textContent = 'Loading...';
                sectorChart.style.display = 'block';
                try {
                    await fetchSectorPerformance();
                    loadSectorsButton.textContent = 'Hide Sector Performance';
                } catch (error) {
                    console.error('Error loading sector performance:', error);
                    sectorChart.innerHTML = 'Error loading sector performance. Please try again.';
                }
                loadSectorsButton.disabled = false;
            } else {
                sectorChart.style.display = 'none';
                loadSectorsButton.textContent = 'Load Sector Performance';
            }
        });
    });


document.getElementById('toggle-mode').addEventListener('change', function() {
    document.documentElement.classList.toggle('white-mode', this.checked);
});

</script>
<script src="script.js"></script>
</body>
</html>
